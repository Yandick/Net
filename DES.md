### 2025/3/6
为了实现这个$P2P$网络的离散事件模拟，我们需要设计一个模拟框架，包括节点、网络连接、数据传输、缓存管理和事件调度等模块：
>1.数据结构设计
>1.1 节点（Node）
>每个节点（客户端或服务器）包含以下属性：
>* id：唯一标识符。
>* position：二维平面坐标 (x, y)。
>* neighbors：邻居节点列表（存储连接的节点）。
>* cache：缓存队列（存储已下载的数据块）。
>* next_expected_block：下一个期望接收的数据块序号（用于判断连续播放）。
>
>1.2 网络连接（Connection）
>每条连接包含以下属性：
>* source：源节点。
>* target：目标节点。
>* bandwidth：传输速率（与距离成反比）。
>
>1.3 数据块（DataBlock）
>每个数据块包含以下属性：
>* id：全局唯一的序号。
>* size：数据块大小（1KB）。
>
>1.4 事件（Event）
>每个事件包含以下属性：
>* type：事件类型（如“生成数据块”、“传输数据块”等）。
>* time：事件发生的时间。
>* source：事件源节点。
>* target：事件目标节点。
>* data：事件相关的数据（如数据块）。

>2. 算法设计
>2.1 初始化
>* 生成 N 个客户端节点和 1 个服务器节点，随机分配坐标 (x, y)。
>* 每个节点随机选择 t 个邻居节点，建立连接。
>* 计算每条连接的传输速率 bandwidth，与节点间距离成反比，范围在 [20KB/s, 100KB/s]。
>
>2.2 事件调度
>* 使用优先队列（按时间排序）管理事件。
>* 主要事件类型：
>   * 服务器生成数据块：
>       * 每秒生成一个数据块，序号递增。
>       * 将数据块加入服务器的缓存。
>       * 生成“传输数据块”事件，将数据块发送给邻居节点。
>* 传输数据块：
>   * 根据传输速率计算传输时间。
>   * 将数据块加入目标节点的缓存。
>   * 如果目标节点缓存已满，覆盖最老的数据块。
>   * 生成“请求数据块”事件，目标节点向邻居请求缺失的数据块。
>* 请求数据块：
>   * 客户端定期检查邻居节点的缓存，请求缺失的数据块。
>   * 生成“传输数据块”事件，邻居节点发送请求的数据块。
>
> 2.3 流畅度计算
>* 每个客户端维护一个 next_expected_block，表示下一个期望接收的数据块序号。
>* 如果客户端缓存中存在连续的 M 个数据块（从 next_expected_block 开始），则客户端可以连续播放。
>* 流畅度计算公式：
>流畅度 = 连续播放时间 / 总模拟时间